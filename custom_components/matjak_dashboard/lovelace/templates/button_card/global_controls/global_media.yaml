global_media:
  template: generic_card
  triggers_update: all

  variables:
    mj_rows:
      - controls

  icon: mdi:speaker-multiple
  name: Media
  state_display: >
    [[[
      const media_players = Object.values(states).filter(item => item.entity_id.split(".")[0] == "media_player");
      const media_players_on = media_players.filter(item => item.state != "off").length;
      const media_players_playing = media_players.filter(item => item.state == "playing").length;

      if (media_players_on == 0) {
        return "0 On";
      }
      return `${media_players_playing} Playing â€¢ ${media_players_on} On`;
    ]]]

  styles:
    card:
      - --icon-color: var(--color-green)

  custom_fields:
    controls:
      card:
        type: custom:layout-card
        layout_type: grid
        layout:
          grid-gap: var(--grid-gap)
          grid-template-columns: 1fr 1fr
          margin: 0
          padding: 0
        cards:
          - type: custom:button-card
            template: generic_card_button
            icon: >
              [[[
                const media_players = Object.values(states).filter(item => item.entity_id.split(".")[0] == "media_player");
                const media_players_playing = media_players.filter(item => item.state == "playing").length;
                return media_players_playing > 0 ? "mdi:pause" : "mdi:play";
              ]]]
            tap_action:
              action: call-service
              service: >
                [[[
                  const media_players = Object.values(states).filter(item => item.entity_id.split(".")[0] == "media_player");
                  const media_players_playing = media_players.filter(item => item.state == "playing").length;
                  return media_players_playing > 0 ? "media_player.media_pause" : "media_player.media_play";
                ]]]
              service_data:
                entity_id: all

          - type: custom:button-card
            template: generic_card_button
            icon: mdi:power
            tap_action:
              action: call-service
              service: media_player.toggle
              service_data:
                entity_id: all